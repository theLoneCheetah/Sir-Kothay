<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile • Sir Kothay?</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>
<body class="bg-gray-100">

  <!-- Fixed Bottom Navbar on Mobile, Top on Desktop -->
  <nav class="fixed bottom-0 left-0 right-0 md:top-0 md:bottom-auto z-50 bg-white/80 backdrop-blur-lg border-t md:border-b border-gray-200/50">
    <div class="max-w-5xl mx-auto">

      <!-- Desktop Navbar (Top) -->
      <div class="hidden md:flex items-center justify-between px-8 py-4">
        <!-- Logo -->
        <a href="../index.html" class="flex items-center gap-3">
          <img src="../static/images/nav-logo.png" class="h-10 rounded-lg shadow-md" alt="Logo" />
        </a>

        <!-- Desktop Links -->
        <div class="flex items-center gap-6 text-sm font-medium">
          <a href="home.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Dashboard</a>
          <a href="profile.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Profile</a>
          <a href="#" onclick="logout()" class="text-red-600 hover:text-red-700">Logout</a>
          <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" target="_blank" class="text-gray-600 hover:text-black">
            <i class="bi bi-github text-xl"></i>
          </a>
        </div>
      </div>

      <!-- Mobile Bottom Navbar -->
      <div class="md:hidden">
        <div class="flex items-center justify-around py-3 bg-white border-t border-gray-200">
          
          <!-- Dashboard -->
          <a href="home.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl transition hover:bg-orange-50" style="color: #4b5563;">
            <i class="bi bi-speedometer2 text-2xl"></i>
            <span class="text-xs font-medium">Dashboard</span>
          </a>
          
          <!-- Profile -->
          <a href="profile.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl transition bg-orange-50" style="color: #f68b1f;">
            <i class="bi bi-person-circle text-2xl"></i>
            <span class="text-xs font-medium">Profile</span>
          </a>
          
          <!-- Logout -->
          <a href="#" onclick="logout()" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-red-600 hover:bg-red-50 transition">
            <i class="bi bi-box-arrow-right text-2xl"></i>
            <span class="text-xs font-medium">Logout</span>
          </a>

          <!-- GitHub -->
          <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" target="_blank" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-gray-600 hover:text-black transition">
            <i class="bi bi-github text-2xl"></i>
            <span class="text-xs font-medium">GitHub</span>
          </a>

        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-0 md:pt-24 pb-20 md:pb-0 min-h-screen">
<div class="pt-6 pb-20 md:pb-6 px-4 max-w-4xl mx-auto">

    <!-- Profile Header Card -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
        <div class="h-32 md:h-40" style="background: linear-gradient(to right, #f68b1f, #f68b1f);"></div>
        
        <div class="relative px-6 pb-8 pt-4 -mt-16 md:-mt-20">
            <div class="flex flex-col md:flex-row items-center md:items-end gap-6">
                <!-- Profile Picture -->
                <div class="relative group">
                    <img id="profileImage" src="../static/images/image.png" alt="User"
                         class="w-28 h-28 md:w-36 md:h-36 rounded-xl border-4 border-white shadow-xl object-cover transition-transform group-hover:scale-105">
                    <div class="absolute inset-0 rounded-xl bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all"></div>
                </div>

                <!-- User Info -->
                <div class="text-center md:text-left flex-1">
                    <h1 id="displayName" class="text-3xl md:text-4xl font-bold text-gray-900">Loading...</h1>
                    <div class="flex flex-wrap items-center justify-center md:justify-start gap-3 mt-2 text-gray-600">
                        <span id="displayEmail" class="flex items-center gap-1"><i class="bi bi-envelope"></i></span>
                        <span id="displayDesignation" class="flex items-center gap-1"></span>
                        <span id="displayOrganization" class="flex items-center gap-1"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Form Card -->
    <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10">
        <div class="flex items-center gap-3 mb-8">
            <div class="p-3 rounded-xl" style="background-color: #fef3e8;">
                <i class="bi bi-person-gear text-2xl" style="color: #f68b1f;"></i>
            </div>
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Edit Profile</h2>
                <p class="text-gray-600">Update your personal information and preferences</p>
            </div>
        </div>

        <form id="profileForm" class="space-y-6" enctype="multipart/form-data">
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Username -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-person-fill" style="color: #f68b1f;"></i> Username
                    </label>
                    <input type="text" id="username" name="username" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>

                <!-- Email -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-envelope-fill" style="color: #f68b1f;"></i> Email
                    </label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>

                <!-- Phone -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-telephone-fill" style="color: #f68b1f;"></i> Phone Number
                    </label>
                    <input type="tel" id="phone_number" name="phone_number"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>

                <!-- Organization -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-building" style="color: #f68b1f;"></i> Organization
                    </label>
                    <input type="text" id="organization" name="organization"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>

                <!-- Designation -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-briefcase-fill" style="color: #f68b1f;"></i> Designation
                    </label>
                    <input type="text" id="designation" name="designation"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition">
                </div>

                <!-- Profile Image -->
                <div>
                    <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-image" style="color: #f68b1f;"></i> Profile Image
                    </label>
                    <input type="file" id="profile_image" name="profile_image" accept="image/*"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition">
                </div>
            </div>

            <!-- Bio -->
            <div>
                <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                    <i class="bi bi-chat-quote-fill" style="color: #f68b1f;"></i> Bio
                </label>
                <textarea id="bio" name="bio" rows="4" placeholder="Tell us a little about yourself..."
                          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition resize-none"></textarea>
            </div>

            <!-- Message Display -->
            <div id="message" class="hidden p-4 rounded-xl"></div>

            <!-- Submit Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                <button type="submit"
                        class="flex-1 order-2 sm:order-1 px-8 py-4 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition shadow-lg transform hover:scale-105">
                    <i class="bi bi-check2-circle mr-2"></i>
                    Save Changes
                </button>
                <a href="home.html"
                   class="flex-1 text-center px-8 py-4 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition order-1 sm:order-2">
                    <i class="bi bi-arrow-left mr-2"></i>
                    Back to Dashboard
                </a>
            </div>
        </form>
    </div>
</div>

<!-- API Config -->
<script src="../static/js/api-config.js"></script>

<script>
// Check if user is logged in
function checkAuth() {
    const token = localStorage.getItem('access_token');
    if (!token) {
        window.location.href = '../auth/login.html';
        return false;
    }
    return true;
}

// Logout function
function logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    window.location.href = '../auth/login.html';
}

// Load user profile
async function loadProfile() {
    if (!checkAuth()) return;

    try {
        console.log('Loading profile...');
        console.log('Token:', localStorage.getItem('access_token') ? 'Present' : 'Missing');
        
        const response = await apiRequest(API_ENDPOINTS.USER_DETAILS);
        console.log('Response status:', response.status);
        
        const data = await response.json();
        console.log('Response data:', data);

        if (response.ok) {
            // Update form fields
            document.getElementById('username').value = data.user_username || '';
            document.getElementById('email').value = data.user_email || '';
            document.getElementById('phone_number').value = data.phone_number || '';
            document.getElementById('organization').value = data.organization || '';
            document.getElementById('designation').value = data.designation || '';
            document.getElementById('bio').value = data.bio || '';

            // Update display
            document.getElementById('displayName').textContent = data.user_username || 'User';
            document.getElementById('displayEmail').innerHTML = `<i class="bi bi-envelope"></i> ${data.user_email || ''}`;
            
            if (data.designation) {
                document.getElementById('displayDesignation').innerHTML = `<span class="text-gray-500">•</span><i class="bi bi-briefcase"></i> ${data.designation}`;
            }
            if (data.organization) {
                document.getElementById('displayOrganization').innerHTML = `<span class="text-gray-500">•</span><i class="bi bi-building"></i> ${data.organization}`;
            }

            if (data.profile_image) {
                document.getElementById('profileImage').src = API_BASE_URL + data.profile_image;
            }
        } else {
            console.error('API Error:', data);
            throw new Error(data.detail || 'Failed to load profile');
        }
    } catch (error) {
        console.error('Profile Load Error:', error);
        showMessage('Failed to load profile. Please clear cache and login again.', 'error');
    }
}

// Save profile
document.getElementById('profileForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData();
    formData.append('username', document.getElementById('username').value);
    formData.append('email', document.getElementById('email').value);
    formData.append('phone_number', document.getElementById('phone_number').value);
    formData.append('organization', document.getElementById('organization').value);
    formData.append('designation', document.getElementById('designation').value);
    formData.append('bio', document.getElementById('bio').value);

    const fileInput = document.getElementById('profile_image');
    if (fileInput.files.length > 0) {
        formData.append('profile_image', fileInput.files[0]);
    }

    try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(API_ENDPOINTS.USER_DETAILS, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            showMessage('Profile updated successfully!', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            const errors = Object.values(data).flat().join(', ');
            showMessage(errors || 'Failed to update profile', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showMessage('Failed to update profile. Please try again.', 'error');
    }
});

function showMessage(text, type) {
    const messageDiv = document.getElementById('message');
    messageDiv.textContent = text;
    messageDiv.className = `p-4 rounded-xl ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
    messageDiv.classList.remove('hidden');
    
    setTimeout(() => {
        messageDiv.classList.add('hidden');
    }, 5000);
}

// Load profile on page load
loadProfile();
</script>

</div>
  </main>

  <footer class="py-12 px-6 mt-4 mb-20 md:mb-4 bg-gray-900 text-gray-300">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
        <div>
          <div class="flex items-center gap-3 mb-4">
            <img src="../static/images/nav-logo.png" class="h-10 rounded-lg" alt="Logo">
            <span class="text-2xl font-bold text-white">Sir Kothay?</span>
          </div>
          <p class="text-gray-400">Simple notes. Strong bonds.</p>
        </div>

        <div>
          <h4 class="font-semibold text-white mb-4">Quick Links</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="home.html" class="hover:text-white transition">Dashboard</a></li>
            <li><a href="profile.html" class="hover:text-white transition">Profile</a></li>
            <li><a href="../about.html" class="hover:text-white transition">About Us</a></li>
          </ul>
        </div>

        <div>
          <h4 class="font-semibold text-white mb-4">Connect</h4>
          <div class="flex gap-4">
            <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" class="text-2xl hover:text-white transition">
              <i class="bi bi-github"></i>
            </a>
            <a href="https://www.facebook.com/uiudevelopershub" class="text-2xl hover:text-white transition">
              <i class="bi bi-facebook"></i>
            </a>
          </div>
          <div class="flex items-center gap-2 mt-6 text-sm">
            <img src="https://github.com/UIU-Developers-Hub.png" class="h-8 w-8 rounded-full" alt="UIU Developers Hub">
            <span>© 2025 Sir Kothay. Made with ❤️ by <a href="https://github.com/UIU-Developers-Hub" style="color: #f68b1f;" class="hover:underline">UIU Developers Hub</a></span>
          </div>
        </div>
      </div>
    </div>
  </footer>

</body>
</html>
