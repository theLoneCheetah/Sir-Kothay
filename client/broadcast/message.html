<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Broadcast - Sir Kothay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>
<body>

  <!-- Fixed Bottom Navbar on Mobile, Top on Desktop -->
  <nav class="fixed bottom-0 left-0 right-0 md:top-0 md:bottom-auto z-50 bg-white/80 backdrop-blur-lg border-t md:border-b border-gray-200/50">
    <div class="max-w-5xl mx-auto">

      <!-- Desktop Navbar (Top) -->
      <div class="hidden md:flex items-center justify-between px-8 py-4">
        <!-- Logo -->
        <a href="../index.html" class="flex items-center gap-3">
          <img src="../static/images/nav-logo.png" class="h-10 rounded-lg shadow-md" alt="Logo" />
        </a>

        <!-- Desktop Links -->
        <div id="desktopNav" class="flex items-center gap-6 text-sm font-medium">
          <a href="../index.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Home</a>
          <a href="../about.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">About</a>
          <a href="../auth/login.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Login</a>
          <a href="../auth/register.html" class="px-5 py-2 text-white rounded-lg" style="background-color: #f68b1f;" onmouseover="this.style.backgroundColor='#e67a0f'" onmouseout="this.style.backgroundColor='#f68b1f'">Sign Up</a>
          <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" target="_blank" class="text-gray-600 hover:text-black">
            <i class="bi bi-github text-xl"></i>
          </a>
        </div>
      </div>

      <!-- Mobile Bottom Navbar -->
      <div class="md:hidden">
        <div class="flex items-center justify-around py-3 bg-white border-t border-gray-200">
          
          <!-- Home -->
          <a href="../index.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl transition hover:bg-orange-50" style="color: #4b5563;">
            <i class="bi bi-house-fill text-2xl"></i>
            <span class="text-xs font-medium">Home</span>
          </a>
          
          <!-- About -->
          <a href="../about.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl transition hover:bg-orange-50" style="color: #4b5563;">
            <i class="bi bi-info-circle-fill text-2xl"></i>
            <span class="text-xs font-medium">About</span>
          </a>
          
          <!-- Login -->
          <a href="../auth/login.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-gray-600 hover:bg-orange-50 transition" style="color: #4b5563;">
            <i class="bi bi-box-arrow-in-right text-2xl"></i>
            <span class="text-xs font-medium">Login</span>
          </a>

          <!-- Sign Up -->
          <a href="../auth/register.html" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-gray-600 hover:bg-orange-50 transition">
            <i class="bi bi-person-plus-fill text-2xl"></i>
            <span class="text-xs font-medium">Sign Up</span>
          </a>

          <!-- GitHub -->
          <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" target="_blank" class="flex flex-col items-center gap-1 px-3 py-2 rounded-xl text-gray-600 hover:text-black transition">
            <i class="bi bi-github text-2xl"></i>
            <span class="text-xs font-medium">GitHub</span>
          </a>

        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-0 md:pt-24 pb-20 md:pb-0 min-h-screen">
<div class="min-h-screen flex items-center justify-center p-4" style="background: linear-gradient(to bottom right, #fef3e8, #ffe8d1, #ffdab3);">
  <div class="w-full max-w-sm">
    <!-- Card -->
    <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-white/50 overflow-hidden">
      <div class="px-6 py-8 text-white text-center" style="background: linear-gradient(to right, #f68b1f, #f68b1f);">
        <div class="relative inline-block">
            <img id="userImage" src="../static/images/image.png" alt="User" class="w-12 h-12 rounded-lg ring-8 ring-white/30 shadow-2xl object-cover">
            <h1 id="userName" class="mt-4 text-2xl font-bold tracking-tight">Loading...</h1>
        </div>
      </div>

      <!-- Compact Info List -->
      <div class="px-6 py-6 space-y-4 bg-white">
        <div class="flex items-center justify-between group">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background-color: #fef3e8;">
              <svg class="w-5 h-5" style="color: #f68b1f;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500">Phone</p>
              <a id="userPhone" href="tel:" class="font-medium text-gray-800 transition" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">
                Loading...
              </a>
            </div>
          </div>
          <button id="copyPhone" class="opacity-0 group-hover:opacity-100 transition p-2 hover:bg-gray-100 rounded-lg">
            <span class="text-xl">üìã</span>
          </button>
        </div>

        <div class="flex items-center justify-between group">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background-color: #fef3e8;">
              <svg class="w-5 h-5" style="color: #f68b1f;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500">Email</p>
              <a id="userEmail" href="mailto:" class="font-medium text-gray-800 transition text-sm" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">
                Loading...
              </a>
            </div>
          </div>
          <button id="copyEmail" class="opacity-0 group-hover:opacity-100 transition p-2 hover:bg-gray-100 rounded-lg">
            <span class="text-xl">üìã</span>
          </button>
        </div>

        <div class="flex items-center justify-between group">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background-color: #fef3e8;">
              <svg class="w-5 h-5" style="color: #f68b1f;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 3h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500">Organization</p>
              <p id="userOrg" class="font-medium text-gray-800">Loading...</p>
            </div>
          </div>
          <button id="copyOrg" class="opacity-0 group-hover:opacity-100 transition p-2 hover:bg-gray-100 rounded-lg">
            <span class="text-xl">üìã</span>
          </button>
        </div>
      </div>

      <!-- Broadcast Message -->
      <div id="broadcastSection" class="hidden px-6 py-5" style="background: linear-gradient(to right, #f68b1f, #f68b1f);">
        <div class="bg-white/20 backdrop-blur-md rounded-2xl p-5 border border-white/30">
          <p id="broadcastMessage" class="text-white font-medium leading-relaxed text-center">
          </p>
        </div>
      </div>
    </div>

  </div>

  <!-- API Config -->
  <script src="../static/js/api-config.js"></script>

  <script>
    // Get user slug from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const userSlug = urlParams.get('user') || window.location.pathname.split('/').pop().replace('.html', '');

    // Load user data
    async function loadUserData() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/broadcast/${userSlug}/`);
        
        if (!response.ok) {
          throw new Error(`API returned ${response.status}: Endpoint not implemented`);
        }
        
        const data = await response.json();

        // Update user information
        document.getElementById('userName').textContent = data.username || data.user_username || 'User';
        document.getElementById('userPhone').textContent = data.phone_number || 'N/A';
        document.getElementById('userPhone').href = `tel:${data.phone_number || ''}`;
        document.getElementById('userEmail').textContent = data.email || data.user_email || 'N/A';
        document.getElementById('userEmail').href = `mailto:${data.email || data.user_email || ''}`;
        document.getElementById('userOrg').textContent = data.organization || 'N/A';

        if (data.profile_image) {
          document.getElementById('userImage').src = API_BASE_URL + data.profile_image;
        }

        // Show broadcast message if exists
        if (data.active_message) {
          document.getElementById('broadcastMessage').textContent = data.active_message;
          document.getElementById('broadcastSection').classList.remove('hidden');
        }

        // Setup copy buttons
        document.getElementById('copyPhone').onclick = () => copyToClipboard(data.phone_number || 'N/A');
        document.getElementById('copyEmail').onclick = () => copyToClipboard(data.email || data.user_email || 'N/A');
        document.getElementById('copyOrg').onclick = () => copyToClipboard(data.organization || 'N/A');
        
      } catch (error) {
        console.error('Error loading user data:', error);
        showErrorState(error.message);
      }
    }

    function showErrorState(errorMsg) {
      document.getElementById('userName').textContent = 'User Not Found';
      document.getElementById('userName').classList.add('text-red-500');
      document.getElementById('userPhone').textContent = 'Endpoint Missing';
      document.getElementById('userEmail').textContent = 'See Console';
      document.getElementById('userOrg').textContent = 'API Error';
      
      // Show error in broadcast section
      document.getElementById('broadcastMessage').innerHTML = `
        <strong>‚ö†Ô∏è Backend API Endpoint Missing</strong><br><br>
        The public broadcast endpoint <code>/api/broadcast/{slug}/</code> is not implemented.<br><br>
        <small>Error: ${errorMsg}</small>
      `;
      document.getElementById('broadcastSection').classList.remove('hidden');
      
      console.error(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    MISSING API ENDPOINT                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë The broadcast page requires a PUBLIC endpoint (no auth needed) ‚ïë
‚ïë                                                                ‚ïë
‚ïë Required Endpoint:                                             ‚ïë
‚ïë   GET /api/broadcast/{user_slug}/                              ‚ïë
‚ïë                                                                ‚ïë
‚ïë Expected Response:                                             ‚ïë
‚ïë   {                                                            ‚ïë
‚ïë     "username": "string",                                      ‚ïë
‚ïë     "email": "string",                                         ‚ïë
‚ïë     "phone_number": "string",                                  ‚ïë
‚ïë     "organization": "string",                                  ‚ïë
‚ïë     "profile_image": "/media/path/to/image.jpg",               ‚ïë
‚ïë     "active_message": "string or null"                         ‚ïë
‚ïë   }                                                            ‚ïë
‚ïë                                                                ‚ïë
‚ïë This endpoint should:                                          ‚ïë
‚ïë   1. Accept user slug as URL parameter                         ‚ïë
‚ïë   2. NOT require authentication (public access)                ‚ïë
‚ïë   3. Return user details + active broadcast message            ‚ïë
‚ïë                                                                ‚ïë
‚ïë Current slug: ${userSlug}                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
      `);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.createElement('div');
        toast.textContent = '‚úì Copied!';
        toast.className = 'fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded-full text-sm shadow-lg z-50 animate-pulse';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
      });
    }

    // Load data on page load
    loadUserData();

    // Check authentication and update nav
    const isAuthenticated = !!localStorage.getItem('access_token');
    if (isAuthenticated) {
      const desktopNav = document.getElementById('desktopNav');
      if (desktopNav) {
        desktopNav.innerHTML = `
          <a href="../dashboard/home.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Dashboard</a>
          <a href="../dashboard/profile.html" class="text-gray-700" style="transition: color 0.2s;" onmouseover="this.style.color='#f68b1f'" onmouseout="this.style.color=''">Profile</a>
          <a href="#" onclick="logoutUser()" class="text-red-600 hover:text-red-700">Logout</a>
          <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" target="_blank" class="text-gray-600 hover:text-black">
            <i class="bi bi-github text-xl"></i>
          </a>
        `;
      }
    }

    function logoutUser() {
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
      window.location.href = '../index.html';
    }
  </script>
</div>
  </main>

  <footer class="py-12 px-6 mt-4 mb-20 md:mb-4 bg-gray-900 text-gray-300">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
        <div>
          <div class="flex items-center gap-3 mb-4">
            <img src="../static/images/nav-logo.png" class="h-10 rounded-lg" alt="Logo">
            <span class="text-2xl font-bold text-white">Sir Kothay?</span>
          </div>
          <p class="text-gray-400">Simple notes. Strong bonds.</p>
        </div>

        <div>
          <h4 class="font-semibold text-white mb-4">Quick Links</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="../index.html#features" class="hover:text-white transition">Features</a></li>
            <li><a href="../about.html" class="hover:text-white transition">About Us</a></li>
            <li><a href="../auth/register.html" class="hover:text-white transition">Sign Up</a></li>
          </ul>
        </div>

        <div>
          <h4 class="font-semibold text-white mb-4">Connect</h4>
          <div class="flex gap-4">
            <a href="https://github.com/UIU-Developers-Hub/Sir-Kothay" class="text-2xl hover:text-white transition">
              <i class="bi bi-github"></i>
            </a>
            <a href="https://www.facebook.com/uiudevelopershub" class="text-2xl hover:text-white transition">
              <i class="bi bi-facebook"></i>
            </a>
          </div>
          <div class="flex items-center gap-2 mt-6 text-sm">
            <img src="https://github.com/UIU-Developers-Hub.png" class="h-8 w-8 rounded-full" alt="UIU Developers Hub">
            <span>¬© 2025 Sir Kothay. Made with ‚ù§Ô∏è by <a href="https://github.com/UIU-Developers-Hub" style="color: #f68b1f;" class="hover:underline">UIU Developers Hub</a></span>
          </div>
        </div>
      </div>
    </div>
  </footer>

</body>
</html>