# Тестирование программного обеспечения
# Лабораторная работа 3. End-to-end тестирование
Выполнил: *Можаев Илья, Университет ИТМО, ТЕСТПО 1.2*

## 1. Выбор проекта
В качестве готового проекта для тестирования выбран проект "Sir Kothay?" (ссылка на [оригинальный репозиторий](https://github.com/UIU-Developers-Hub/Sir-Kothay)). Это веб-приложение, предоставляющий пользовательский интерфейс в браузере. В нём доступны следующие функции:
* Регистрация нового пользователя.
* Вход в систему.
* Управление профилем.
* Создание и редактирование "трансляционных" сообщений.
* Активация сообщения и просмотр публичной страницы.

Проект использует инструменты Django (Python), JavaScript, CSS, HTML-страницы с изображениями. Его можно полностью развернуть локально и протестировать вручную, что делает его удобным для проведения независимого тестирования. Код исходного модуля (за одним небольшим исправлением, которое помогло наладить его работу) находится в папке bin/ ([GitHub](https://github.com/theLoneCheetah/Sir-Kothay/tree/main/bin)).

## 2. Анализ пользовательских сценариев
Основная цель проекта - предоставление инструментов создания и показа "трансляционных" сообщений, а также аутентификация пользователей в системе. Поэтому для E2E-тестирования выбраны два следующих сценария:
1. Регистрация, вход и выход. Новый пользователь создаёт аккаунт, авторизуется в системе, попадая в личный кабинет, затем выходит из него. Тест должен проверять корректность форм, отправку данных, обработку ответов и редиректы. Если этот путь не работает, пользователь не сможет пользоваться сервисом.
2. Создание и активация сообщения, проверка публичной страницы. Пользователь создаёт новое сообщение, активирует его и переходит на свою публичную страницу (доступную без логина), где проверяет отображение сообщения. Тест должен проверять механизм создания, публикации сообщения и его просмотр на отдельной странице. Это основная бизнес-логика приложения — пользователь должен иметь возможность поделиться сообщением через публичную ссылку.

## 3. Подготовка окружения и запуск проекта
Для запуска серверной (backend) и клиентской (frontend) частей приложения выполните в консоли следующие команды (в отдельных окнах):
```
python3 bin/server/manage.py runserver
python3 -m http.server 5500 -d bin/client
```
Таким образом, сервер будет слушать порт 8000, а клиентская часть запустится на порту 5500. Можно самостоятельно протестировать возможности приложения, открыв его в браузере по ссылке [http://127.0.0.1:5500/](http://127.0.0.1:5500/).

## 4. Написание E2E-тестов
Для тестиования выбранных сценариев было написано два теста с использованием фреймворка pytest. Они изолированы друг от друга и воспроизводимы, за исключением генерации уникального идентификатора пользователя.
1. test_registration_login_logout - проверяет регистрацию, вход пользователя в систему и выход из неё. После авторизации проверяет корректность отображения имени пользователя, при несовпадении выводит ошибку. Делает скриншоты экрана на этапе регистрации и выхода из аккаунта.
2. test_create_message_and_public_page - аналогично выполняет регистрацию и вход, после чего проверяет функцию создания нового сообщения, его активации и перехода на публичную ссылку в новой вкладке. Сверяет данные отображаемого сообщения с заданным, при несовпадении выводит ошибку. Делает скриншот дашборда после активации сообщения и скриншот публичной страницы.

В отдельную функцию user_registration_and_login помещена логика регистрации и входа пользователя, одинаковая для тестов. Она использует вспомогательную функцию для генерации нового пользователя generate_test_user.

В тестах используется отображение браузерной сессии в отдельном окне с задержкой действий для наглядности и отслеживания выполняемых команд с помощью модуля Playwright. Публичная страница после второго теста становится доступной любому пользователя по её адресу (в данном случае в рамках localhost).

## 5. Результаты запуска тестов
Запустить тестирование с помощью pytest можно командой `python3 -m pytest test_e2e.py -v --capture=no`. Перехват с помощью capture отключается для вывода сообщений об ошибках в консоль. Результат запуска показан на скриншоте ниже.

<img width="1351" height="238" alt="image_2026-02-24_11-58-24" src="https://github.com/user-attachments/assets/75d03960-e519-4df8-abcf-0442567563f1" />

Первоначально запуски тестов показали, что успешная регистрация невозможна из-за отсутствия действия 'register' в правах доступах метода get_permissions файла api_views.py. Это позволило выявить проблему на раннем этапе и устранить её.

В дальнейшем оба теста были завершены успешно. В процессе работы тестировочной сессии браузера можно видеть, что задержек между действиями Playwright в тестах практически нет (исключая искусственную задержку для наглядности). Наибольшее время ожидания наблюдается при создании и авторизации пользователя и перенаправлении на различные страницы, что заложено в самой логике приложения.

Скриншоты после одного из запусков можно найти в папке screenshots/.

## 6. Выводы
1. Тестирование с помощью Playwright выявило проблему в исходном коде проекта и позволило устранить её на раннем этапе тестирования.
2. После этого тестирования обоих пользовательских сценариев прошло успешно. Это говорит о корректности взаимодействия серверной и клиентской стороны при работе с типичными сценариями, а также структурированности приложения и БД.
3. Плюсы:
   * Интерфейс интуитивно понятен, визуально удобен и снабжён заметными кнопками.
   * При добавлении сообщений данные корректно подгружаются без перезагрузки страницы.
   * Публичная страница создаётся быстро, доступна и отображает актуальную информацию.
4. Минусы:
   * После регистрации нет автоматического входа, необходимо вводить данные заново для авторизации (это может быть в целях безопасности).
   * Перенаправление после регистрации и после авторизации занимает не менее секунды.
   * Отсутствует подтверждение действия либо индикатор загрузки при активации сообщения, хотя само действие выполняется (в процессе работы сессии браузера в этот момент видна небольшая задержка).
5. В качестве улучшений в приложении можно добавить индикацию выполняемых действий (создание, активация/деактивация сообщения) либо сообщения об успехе, а также блокировать повторные нажатию кнопок во время выполнения внутренних команд.
6. Модуль для end-to-end тестирования Playwright предоставляет мощные инструменты автоматизации пользовательского взаимодействия с реальным браузерным приложением, проводить тестирование полноценных сценариев и отлаживать ошибки.
